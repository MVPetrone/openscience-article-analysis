---
title: "2_has_data_and_accessible"
output: html_document
date: "2025-07-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)

data <- read.csv("data.csv")

# Calculate the percentage of articles with data that make it accessible
percentage_data_accessible <- data %>%
  # Filter for articles that explicitly have data in the paper
  filter(Is.there.data.explicitly.in.the.paper. == "Yes") %>%
  # Now, from this subset, count those that also share data
  mutate(
    data_shared_and_accessible = ifelse(
      Is.there.data.shared. %in% c("Partially", "Fully"),
      1,
      0
    )
  ) %>%
  # Summarize to get the counts and calculate percentage
  summarise(
    total_articles_with_data = n(),
    articles_with_accessible_data = sum(data_shared_and_accessible, na.rm = TRUE)
  ) %>%
  # Calculate the percentage
  mutate(
    percentage = (
      articles_with_accessible_data / total_articles_with_data
    ) * 100
  )

# Print the result
print(percentage_data_accessible)

# --- NEW: Calculate comprehensive percentages for all categories ---
comprehensive_stats <- data %>%
  mutate(
    # Categorize all articles into three main groups
    article_category = case_when(
      # Articles with no data
      Is.there.data.explicitly.in.the.paper. == "No" ~ "No Data",
      # Articles with data that is accessible (shared)
      Is.there.data.explicitly.in.the.paper. == "Yes" & 
        Is.there.data.shared. %in% c("Partially", "Fully") ~ "Has Data & Accessible",
      # Articles with data that is not accessible
      Is.there.data.explicitly.in.the.paper. == "Yes" & 
        Is.there.data.shared. == "No" ~ "Has Data & Not Accessible",
      # Articles with data but sharing status unknown
      Is.there.data.explicitly.in.the.paper. == "Yes" & 
        is.na(Is.there.data.shared.) ~ "Has Data & Status Unknown",
      # Handle any other cases
      TRUE ~ "Other/Unknown"
    )
  ) %>%
  # Calculate counts and percentages for each category
  group_by(article_category) %>%
  summarise(count = n()) %>%
  ungroup() %>%
  mutate(
    total_articles = sum(count),
    percentage = (count / total_articles) * 100,
    label = paste0(count, " (", round(percentage, 1), "%)")
  )

# Print comprehensive statistics
cat("=== COMPREHENSIVE ARTICLE STATISTICS ===\n")
print(comprehensive_stats)

# Extract specific percentages for easy reference
pct_no_data <- comprehensive_stats %>% 
  filter(article_category == "No Data") %>% 
  pull(percentage)

pct_has_data_accessible <- comprehensive_stats %>% 
  filter(article_category == "Has Data & Accessible") %>% 
  pull(percentage)

pct_has_data_not_accessible <- comprehensive_stats %>% 
  filter(article_category == "Has Data & Not Accessible") %>% 
  pull(percentage)

cat("\n=== KEY PERCENTAGES ===\n")
cat("Percentage of articles having no data:", round(pct_no_data, 1), "%\n")
cat("Percentage of articles having data and making it accessible:", round(pct_has_data_accessible, 1), "%\n")
cat("Percentage of articles having data and not making it accessible:", round(pct_has_data_not_accessible, 1), "%\n")

# --- Data Preparation for Bar Chart (Articles with Data Only) ---
plot_data <- data %>%
  filter(Is.there.data.explicitly.in.the.paper. == "Yes") %>%
  mutate(
    Data_Accessibility_Category = case_when(
      Is.there.data.shared. %in% c("Partially", "Fully") ~ "Data Shared (Accessible)",
      Is.there.data.shared. == "No" ~ "Data Not Shared",
      is.na(Is.there.data.shared.) ~ "Data Sharing Status Unknown",
      TRUE ~ "Other/Unexpected Status"
    )
  ) %>%
  group_by(Data_Accessibility_Category) %>%
  summarise(Count = n()) %>%
  ungroup() %>%
  mutate(
    Total_Articles = sum(Count),
    Percentage = (Count / Total_Articles) * 100,
    Label = paste0(Count, " (", round(Percentage, 1), "%)")
  ) %>%
  arrange(
    factor(
      Data_Accessibility_Category,
      levels = c(
        "Data Shared (Accessible)",
        "Data Not Shared",
        "Data Sharing Status Unknown",
        "Other/Unexpected Status"
      )
    )
  )

# --- Create Bar Chart for Articles with Data Only ---
bar_heights <- plot_data$Count
names(bar_heights) <- plot_data$Data_Accessibility_Category

bar_colors <- c(
  "Data Shared (Accessible)" = "#4CAF50",
  "Data Not Shared" = "#FFC107",
  "Data Sharing Status Unknown" = "#9E9E9E",
  "Other/Unexpected Status" = "#F44336"
)

ordered_colors <- bar_colors[names(bar_heights)]

bar_midpoints <- barplot(
  bar_heights,
  main = "Data Accessibility Status of Articles with Explicit Data",
  xlab = "Data Accessibility Category",
  ylab = "Number of Articles",
  col = ordered_colors,
  ylim = c(0, max(bar_heights) * 1.2),
  cex.names = 0.8,
  las = 2
)

text(
  x = bar_midpoints,
  y = bar_heights,
  labels = plot_data$Label,
  pos = 3,
  cex = 0.8
)

title(sub = "Distribution among articles that explicitly mention data in the paper")

# --- NEW: Create Comprehensive Bar Chart for All Articles ---
# Prepare data for the comprehensive chart
comprehensive_plot_data <- comprehensive_stats %>%
  filter(article_category %in% c("No Data", "Has Data & Accessible", "Has Data & Not Accessible")) %>%
  arrange(factor(article_category, levels = c("Has Data & Accessible", "Has Data & Not Accessible", "No Data")))

# Create bar chart for all articles
comp_bar_heights <- comprehensive_plot_data$count
names(comp_bar_heights) <- comprehensive_plot_data$article_category

# Define colors for comprehensive chart
comp_bar_colors <- c(
  "Has Data & Accessible" = "#4CAF50",      # Green
  "Has Data & Not Accessible" = "#FF9800",  # Orange
  "No Data" = "#2196F3"                     # Blue
)

comp_ordered_colors <- comp_bar_colors[names(comp_bar_heights)]

comp_bar_midpoints <- barplot(
  comp_bar_heights,
  main = "Comprehensive Article Classification by Data Availability and Accessibility",
  xlab = "Article Category",
  ylab = "Number of Articles",
  col = comp_ordered_colors,
  ylim = c(0, max(comp_bar_heights) * 1.2),
  cex.names = 0.9,
  las = 2
)

# Add labels on bars
text(
  x = comp_bar_midpoints,
  y = comp_bar_heights,
  labels = comprehensive_plot_data$label,
  pos = 3,
  cex = 0.9
)

title(sub = "Distribution across all articles in the dataset")

# --- NEW: Create a Pie Chart for Overall Distribution ---
pie(
  comp_bar_heights,
  labels = paste(names(comp_bar_heights), "\n", comprehensive_plot_data$label),
  col = comp_ordered_colors,
  main = "Overall Distribution of Articles by Data Status",
  cex = 0.8
)
```
